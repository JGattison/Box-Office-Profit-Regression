load("~/Portfolio Projects/Box Office/BoxOffice.RData")
box_office_FINAL <- box_office_FINAL %>%
#  select(-new_dates) %>%
distinct() %>%
filter(!is.na(genre)) %>%
dplyr::select(Movie_id, Title.y, Rating, TotalVotes, MetaCritic, Budget, Runtime,
Votes1000, VotesM, VotesF, VotesU18, VotesU18M, VotesU18F, Votes1829,
Votes1829M, Votes1829F, Votes3044, Votes3044M, Votes3044F, Votes45A,
Votes45AF, Votes45AM, VotesIMDB, VotesUS, VotesnUS, Domestic, Worldwide,
genre, `Release Date_3.y`, year, release_month, Revenue, profit,
Profit_perc, top_bo_4weeks, debut_top, top10_gross_4weeks, overall_gross_4weeks,
num_releases, occasion)
library(dplyr)
library(DataExplorer)
library(ggplot2)
library(stringr)
library(lubridate)
library(tidyr)
library(lmtest)
library(MASS)
library(car)
library(sandwich) #For robust GLM
library(lmtest)
box_office_FINAL_binary_encoded <- box_office_FINAL %>%
# Create a binary flag for each genre
mutate(value = 1) %>%
distinct() %>%
# Spread genres into their own binary columns
spread(key = genre, value = value, fill = 0) %>%
filter(!is.na(profit))
box_office_FINAL_binary_encoded_clean = na.omit(box_office_FINAL_binary_encoded)
export <- box_office_FINAL_binary_encoded %>%
select(profit, TotalVotes, Budget, MetaCritic, overall_gross_4weeks, VotesM, VotesF)
export <- box_office_FINAL_binary_encoded %>%
dplyr::select(profit, TotalVotes, Budget, MetaCritic, overall_gross_4weeks, VotesM, VotesF)
write.csv(export)
write.csv(export, file = "export.csv")
colnames(box_office_FINAL_binary_encoded)
# Remove the interactions because they are making the linearity assumption not true and also they are not strong coefficients in the model.
# Add in Male vs Female & Age votes
stepwise_glm4 <- glm(profit ~ TotalVotes + Budget + Rating + Runtime + MetaCritic +
top_bo_4weeks + overall_gross_4weeks +
VotesU18 + Votes1829 +
Votes3044 + Votes45A + VotesM + VotesF, family = gaussian(link = "identity"), data = box_office_FINAL_binary_encoded_clean)
stepwise_glm5 = stepAIC(stepwise_glm4, k = log(nrow(box_office_FINAL_binary_encoded_clean)), direction = "both")
robust_se4 <- coeftest(stepwise_glm5, vcov = vcovHC(stepwise_glm5, type = "HC3"))
robust_se4
# Add in Male voters back in because of unexpected coefficient in 1829 variable
stepwise_glm6 <- glm(profit ~ TotalVotes + Budget + MetaCritic +
overall_gross_4weeks + VotesM + VotesF, family = gaussian(link = "identity"), data = box_office_FINAL_binary_encoded_clean)
summary(stepwise_glm6)
robust_se5 <- coeftest(stepwise_glm6, vcov = vcovHC(stepwise_glm6, type = "HC3"))
robust_se5
export <- box_office_FINAL_binary_encoded %>%
dplyr::select(profit, TotalVotes, Budget, MetaCritic, overall_gross_4weeks, VotesM, VotesF, Rating)
write.csv(export, file = "export.csv")
# Add in Male voters back in because of unexpected coefficient in 1829 variable
stepwise_glm6 <- glm(profit ~ TotalVotes + Budget +
overall_gross_4weeks + VotesM + VotesF, family = gaussian(link = "identity"), data = box_office_FINAL_binary_encoded_clean)
summary(stepwise_glm6)
robust_se5 <- coeftest(stepwise_glm6, vcov = vcovHC(stepwise_glm6, type = "HC3"))
robust_se5
# Add in Male voters back in because of unexpected coefficient in 1829 variable
# Test VotesM interactions, given that the coefficient isn't intuitive
stepwise_glm6 <- glm(profit ~ VotesM * (TotalVotes + Budget +
overall_gross_4weeks + VotesF), family = gaussian(link = "identity"), data = box_office_FINAL_binary_encoded_clean)
summary(stepwise_glm6)
robust_se5 <- coeftest(stepwise_glm6, vcov = vcovHC(stepwise_glm6, type = "HC3"))
robust_se5
stepwise_glm7 <- stepAIC(stepwise_glm6, k = log(nrow(box_office_FINAL_binary_encoded_clean)), direction = 'both')
robust_se5 <- coeftest(stepwise_glm7, vcov = vcovHC(stepwise_glm7, type = "HC3"))
robust_se5
stepwise_glm8 <- glm(profit ~ VotesM * Budget + TotalVotes + Budget +
overall_gross_4weeks + VotesF, family = gaussian(link = "identity"), data = box_office_FINAL_binary_encoded_clean)
anova(stepwise_glm8, stepwise_glm6)
anova(stepwise_glm8, stepwise_glm7)
robust_se6 <- coeftest(stepwise_glm8, vcov = vcovHC(stepwise_glm8, type = "HC3"))
robust_se6
robust_se5
# Add in Male voters back in because of unexpected coefficient in 1829 variable
# Test VotesM interactions, given that the coefficient isn't intuitive
stepwise_glm6 <- glm(profit ~ VotesM + TotalVotes + Budget +
overall_gross_4weeks + VotesF), family = gaussian(link = "identity"), data = box_office_FINAL_binary_encoded_clean)
# Add in Male voters back in because of unexpected coefficient in 1829 variable
# Test VotesM interactions, given that the coefficient isn't intuitive
stepwise_glm6 <- glm(profit ~ VotesM + TotalVotes + Budget +
overall_gross_4weeks + VotesF, family = gaussian(link = "identity"), data = box_office_FINAL_binary_encoded_clean)
summary(stepwise_glm6)
robust_se5 <- coeftest(stepwise_glm6, vcov = vcovHC(stepwise_glm6, type = "HC3"))
robust_se5
#VotesM isn't significant
final_model <-  glm(profit ~ TotalVotes + Budget +
overall_gross_4weeks + VotesF, family = gaussian(link = "identity"), data = box_office_FINAL_binary_encoded_clean)
robust_model <- coeftest(final_model, vcov = vcovHC(final_model, type = "HC3"))
robust_model
(stepwise_glm6)
summary(stepwise_glm6)
robust_se5
robust_model
unique(box_office_FINAL_binary_encoded$year)
save.image("~/Portfolio Projects/Box Office/BoxOffice.RData")
